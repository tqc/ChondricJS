/*! chondric-tools 0.4.1 */

window.console||(window.console={log:function(){},error:alert});var Chondric=angular.module("chondric",[]);Chondric.allTransitions={},Chondric.sharedUiComponents={},Chondric.registerSharedUiComponent=function(component){Chondric.sharedUiComponents[component.id]=component},Chondric.App=Chondric.initApp=function(options){function registerController(name,func){app.controllerProvider?(app.controllerProvider.register(name,func),delete controllerPreload[name]):controllerPreload[name]=func}function preloadTemplate(templateUrl){app.module.run(function($templateCache,$http){$http.get(templateUrl,{cache:$templateCache})})}function loadScripts(scriptGroupNum,callback){return console.log("starting loadscripts"),scriptGroupNum>=settings.scriptGroups.length?callback():(console.log("calling require"),void require(settings.scriptGroups[scriptGroupNum],function(){loadScripts(scriptGroupNum+1,callback)}))}function initData(callback){console.log("getting database"),app.db=settings.getDatabase(),app.db?app.db.updateDatabase(function(){callback()}):callback()}function attachEvents(callback){callback()}function complete(callback){app.debugMode&&$("body").addClass("debugmode"),app.ready=!0,callback()}{var app={},controllerPreload={},allRoutes=(app.module=angular.module(options.name||"appModule",["chondric"].concat(options.angularModules||[]),function($controllerProvider){app.controllerProvider=$controllerProvider;for(var cn in controllerPreload||{})registerController(cn,controllerPreload[cn])}),app.allRoutes={});app.allTransitions=Chondric.allTransitions}app.createViewTemplate=function(baseView,templateId,templateFile,viewOptions){"string"==typeof templateId?(viewOptions.baseView=baseView,viewOptions.templateId=templateId,viewOptions.templateFile=templateFile):viewOptions=baseView;var page={};viewOptions.initAngular&&(viewOptions.initAngular.call(page),viewOptions.controllers=viewOptions.controllers||page.controllers);var pageController=null;viewOptions.controller&&(pageController=viewOptions.controller);for(var cn in viewOptions.controllers||{})pageController||(pageController=viewOptions.controllers[cn]),registerController(cn,viewOptions.controllers[cn]);pageController||console.error("View "+(viewOptions.templateId||viewOptions.route)+" has no controller");var route=viewOptions.route||"/"+viewOptions.templateId+"/$p1/$p2",templateUrl=viewOptions.templateId+".html";viewOptions.templateFolder&&(templateUrl=viewOptions.templateFolder+"/"+templateUrl),allRoutes[route]={isSection:!1,controller:pageController,templateUrl:templateUrl,templateId:viewOptions.templateId},preloadTemplate(templateUrl)},app.createSection=function(viewOptions){var pageController=null;viewOptions.controller&&(pageController=viewOptions.controller);for(var cn in viewOptions.controllers||{})pageController||(pageController=viewOptions.controllers[cn]),registerController(cn,viewOptions.controllers[cn]);var route=viewOptions.route;allRoutes[route]={isSection:!0,controller:pageController}},app.sharedUiComponents=Chondric.sharedUiComponents,app.registerSharedUiComponent=Chondric.registerSharedUiComponent;app.controller=function($scope,$location){function loadView(url){if(!url)return void console.log("default route");var matchingRoutes=[],parts=url.split("/");routeLoop:for(var r in allRoutes){for(var rparts=r.split("/"),i=0;i<rparts.length;i++)if(rparts[i]!=parts[i]&&"$"!=rparts[i][0])continue routeLoop;matchingRoutes.push(r)}matchingRoutes.sort(function(a,b){return a.length-b.length});for(var openViews=$scope.openViews,i=0;i<matchingRoutes.length;i++){for(var template=$scope.allRoutes[matchingRoutes[i]],mrp=matchingRoutes[i].split("/"),ar="",params={},j=0;j<mrp.length;j++)"$"==mrp[j][0]&&(params[mrp[j].substr(1)]=decodeURIComponent(parts[j])),parts[j]&&(ar+="/"+parts[j]);if(!template.isSection){console.log("Get page with route "+ar);var page=openViews[ar];return void(page||(page=openViews[ar]={controller:template.controller,templateUrl:template.templateUrl,templateId:template.templateId,params:params}))}console.log("Get section with route "+ar);var section=openViews[ar];section||(section=openViews[ar]={controller:template.controller,isSection:!0,params:params,subsections:{}}),openViews=section.subsections}}function viewCleanup(viewCollection,preservedRoutes){for(var k in viewCollection)if(0==k.indexOf("/")){for(var keep=!1,i=0;i<preservedRoutes.length;i++){var r=preservedRoutes[i];if(r&&0==r.indexOf(k)){keep=!0;break}}if(keep)viewCollection[k].subsections&&viewCleanup(viewCollection[k].subsections,preservedRoutes);else{for(var shik in app.componentStatesForRoutes)0==shik.indexOf(k)&&delete app.componentStatesForRoutes[shik];for(var shik in app.scopesForRoutes)0==shik.indexOf(k)&&delete app.scopesForRoutes[shik];delete viewCollection[k]}}}app.scope=$scope,$scope.allRoutes=allRoutes,$scope.route=null,$scope.nextRoute=null,$scope.lastRoute=null,$scope.transition={type:"crossfade",progress:0},$scope.openViews={},$scope.sharedUiComponents=app.sharedUiComponents,$scope.showModal=function(name,lastTap){$scope[name]=lastTap},$scope.hideModal=function(name){$scope[name]=null},$scope.setSharedUiComponentState=app.setSharedUiComponentState=function(routeScope,componentId,active,available,data){app.scopesForRoutes[routeScope.rk]=routeScope;var component=app.sharedUiComponents[componentId];if(!component)throw new Error("Shared UI Component "+componentId+" not found");var csfr=app.componentStatesForRoutes[routeScope.rk]=app.componentStatesForRoutes[routeScope.rk]||{};csfr[componentId]={route:routeScope.rk,active:active,available:available,data:data},$scope.route==routeScope.rk&&component.setState(component,routeScope.rk,active,available,data)},app.scopesForRoutes={},app.componentStatesForRoutes={},$scope.changePage=app.changePage=function(p,transition){if(p instanceof Array)for(var r="",i=0;i<p.length;i++)r+="/"+p[i];else var r=p;return!r||r.indexOf("/")<0?void console.error("changePage syntax has changed - the first parameter is a route url instead of an id"):void($scope.route!=r&&($scope.lastRoute==r&&($scope.lastRoute=null),$scope.transition.type=transition||"crossfade",$scope.noTransition=!0,loadView(r),$scope.nextRoute=r,$scope.transition.progress=0,$scope.transition.from=$scope.route,$scope.transition.to=$scope.nextRoute,window.setTimeout(function(){$scope.noTransition=!1,$scope.route=r,$scope.transition.progress=1,$scope.$apply()},100)))},$scope.updateSwipe=function(swipeState,swipeNav,pageScope){if(swipeState&&swipeNav){for(var k in app.sharedUiComponents){var component=app.sharedUiComponents[k];component.updateSwipe&&component.updateSwipe(component,swipeState)}for(var p in swipeState)if(swipeState[p]&&swipeNav[p]){if(console.log("updating swipe - left border"),swipeNav[p].route)loadView(swipeNav[p].route),$scope.nextRoute=swipeNav[p].route,$scope.transition.from=$scope.route,$scope.transition.to=$scope.nextRoute,$scope.transition.type=swipeNav[p].transition,$scope.transition.progress=swipeState[p];else if(swipeNav[p].panel){var showModal=pageScope.$eval("showModal");showModal(swipeNav[p].panel,{progress:swipeState[p],transition:swipeNav[p].transition})}$scope.$apply()}}},$scope.endSwipe=function(swipeState,swipeNav,pageScope){if(swipeState&&swipeNav){console.log("ending swipe");for(var k in app.sharedUiComponents){var component=app.sharedUiComponents[k];component.endSwipe&&component.endSwipe(component,swipeState)}for(var p in swipeState)if(swipeState[p]&&swipeNav[p]){if(console.log("ending swipe - "+p),swipeNav[p].route)swipeState[p]>.6?(loadView(swipeNav[p].route),$scope.transition.progress=1,$scope.lastRoute=$scope.route,$scope.route=swipeNav[p].route):$scope.transition.progress=0;else if(swipeNav[p].panel)if(swipeState[p]>.1){var showModal=pageScope.$eval("showModal");showModal(swipeNav[p].panel,{progress:1,transition:swipeNav[p].transition})}else{var hideModal=pageScope.$eval("hideModal");hideModal(swipeNav[p].panel)}$scope.$apply()}}},$scope.$watch("transition",function(transition){if(transition&&transition.to){var fromStates=app.componentStatesForRoutes[transition.from]||{},toStates=app.componentStatesForRoutes[transition.to]||{};for(var k in app.sharedUiComponents){var component=app.sharedUiComponents[k],fromState=fromStates[k]||{route:transition.from,active:!1,available:!1,data:null},toState=toStates[k]||{route:transition.to,active:!1,available:!1,data:null};component.setStatePartial?component.setStatePartial(component,fromState,toState,transition.progress):transition.progress>.5?component.setState(component,toState.route,toState.active,toState.available,toState.data):component.setState(component,fromState.route,fromState.active,fromState.available,fromState.data)}}},!0),$scope.$watch("route",function(url,oldVal){document.activeElement&&document.activeElement.blur(),$scope.nextRoute=null,$scope.lastRoute=oldVal,console.log("Route changed to "+url+" from "+oldVal),url&&$location.path(url).replace(),loadView(url),viewCleanup($scope.openViews,[$scope.route,$scope.nextRoute,$scope.lastRoute])}),options.appCtrl&&options.appCtrl($scope)};app.ready=!1,app.autohidesplashscreen=!1,app.Pages={},app.Actions={},app.startTime=(new Date).getTime(),app.Views={},app.ViewTemplates={},app.platform="web",app.isSimulator=!1;var settings={name:"Base App",mightBePhoneGap:!0,loadPageFromHash:!0,scriptGroups:[],angularModules:[],contexts:{},getDatabase:null,loadData:function(loadedctx,callback){callback()},customInit:function(callback){callback()},updateNotificationSettings:function(){console.warn("updateNotificationSettings is not implemented")},notificationReceived:function(){console.warn("notificationReceived is not implemented")},debugMode:!1};$.extend(settings,options),app.settings=settings,app.debugMode=settings.debugMode,app.angularModules=settings.angularModules,app.notificationReceived=settings.notificationReceived,app.angularAppModule=angular.module("AppModule",["chondric"].concat(app.angularModules),function($controllerProvider){app.controllerProvider=$controllerProvider}),this.appLoadLog=function(msg){console.log(msg)},this.getView=function(viewId){var view=app.Views[viewId];if(view)return view;var ind=viewId.indexOf("_"),templateId=viewId.substr(0,ind)||viewId;return app.ViewTemplates[templateId]||app.createViewTemplate({templateId:templateId}),view=app.Views[viewId]=new app.ViewTemplates[templateId]({id:viewId})};var pageCleanupTimer=0;this.pageCleanup=function(){var currentPage=app.activeView,lastPage=app.lastPage,preloads=app.activeView.preloads||[];currentPage.next&&preloads.push(currentPage.next),currentPage.prev&&preloads.push(currentPage.prev);for(var k in app.Views)if(!(currentPage&&currentPage.id==k||currentPage&&currentPage.prev==k||currentPage&&currentPage.next==k||lastPage&&lastPage.id==k||preloads.indexOf(k)>=0)){var v=app.Views[k];v&&v.unload(),delete app.Views[k]}for(var i=0;i<preloads.length;i++)app.getView(preloads[i]).ensureLoaded(null,function(){});pageCleanupTimer=0},this.queuePageCleanup=function(){pageCleanupTimer||(pageCleanupTimer=window.setTimeout(app.pageCleanup,200))},this.transition=function(nextPageId,inPageClass,outPageClass){if(app.transitioning){if(app.transitioningTo==nextPageId)return;app.transitioning=!1,app.transitioningTo=void 0}app.transitioning=!0,app.transitioningTo=nextPageId;var thisPage=app.lastPage=app.activeView;thisPage.ensureLoaded("active",function(){var nextPage=app.getView(nextPageId);thisPage.deactivating(nextPage),nextPage.ensureLoaded(inPageClass,function(){window.setTimeout(function(){history.pushState({},null,"#"+nextPageId),nextPage.loading?nextPage.isActivating=!0:(nextPage.activating(thisPage),nextPage.scope&&nextPage.scope.$apply())},0),thisPage.element.one("webkitTransitionEnd",function(){window.setTimeout(function(){app.transitioning=!1,app.transitioningTo=void 0,app.splashScreenHidden||app.hideSplashScreen(),nextPage.loading?nextPage.isActivated=!0:(nextPage.activated(),nextPage.scope&&nextPage.scope.$apply()),app.queuePageCleanup()},0)}),thisPage.setSwipePosition(null,nextPage.element,null),thisPage.element.addClass(outPageClass).removeClass("active"),nextPage.element.addClass("active").removeClass(inPageClass),"behinddlg"==outPageClass&&(nextPage.dlgbg=thisPage.id),app.activeView=nextPage})})},this.transitions={pop:{inPageClass:"behindsmall",outPageClass:"behindfull"},dlgpop:{inPageClass:"behindsmall",outPageClass:"behinddlg"},dlgclose:{inPageClass:"behinddlg",outPageClass:"behindsmall"},close:{inPageClass:"behindfull",outPageClass:"behindsmall"},prev:{inPageClass:"prev",outPageClass:"next"},next:{inPageClass:"next",outPageClass:"prev"},crossfade:{inPageClass:"behindfull",outPageClass:"behindfull"}};var initEvents=function(callback){callback()},loadFirstPage=function(callback){if(app.scope.route)return callback();if(settings.loadPageFromHash&&location.hash.length>1&&location.hash.indexOf("access_token=")<0){for(var parts=location.hash.substr(2).split("/"),i=0;i<parts.length;i++)parts[i]=decodeURIComponent(parts[i]);app.changePage(parts)}else settings.firstPageTemplate&&app.changePage(settings.firstPageTemplate,"crossfade");callback()};app.splashScreenHidden=!1,app.hideSplashScreen=function(){app.splashScreenHidden||("cordova"==app.platform&&navigator&&navigator.splashscreen&&navigator.splashscreen.hide(),app.splashScreenHidden=!0)},app.registerForNotifications=function(){"cordova"==app.platform&&window.plugins&&window.plugins.pushNotification&&window.plugins.pushNotification.register(function(result){settings.updateNotificationSettings(result,!0)},function(error){console.error(error),settings.updateNotificationSettings(null,!1)},{badge:"true",sound:"true",alert:"true",ecb:"app.notificationReceived"})};var loadHostSettings=function(callback){$.ajax({url:"../settings.json"+location.search,dataType:"json",error:function(){console.warn("error loading ../settings.json"),app.hostSettings={},callback()},success:function(data){app.hostSettings=data,void 0!==data.debug&&(app.debugMode=data.debug),callback()}})};app.init=function(){console.warn("no longer need to call app.init manually")};var init=function(callback){console.log("beginning app initialization");var initInternal=function(){app.scope.platform=app.platform,app.scope.$apply();var sizeChanged=function(){var w=$(window).width(),h=$(window).height();console.log(w+","+h),1024==h||768==h||320==h||568==h||480==h?$(".viewport").addClass("hasstatusbar"):$(".viewport").removeClass("hasstatusbar"),768>w&&1!=app.scope.maxColumns?(console.log("setting singlecolumn"),app.scope.maxColumns=1,$(".viewport").addClass("singlecolumn"),app.scope.$apply()):w>=768&&3!=app.scope.maxColumns&&(console.log("setting multicolumn"),app.scope.maxColumns=3,$(".viewport").removeClass("singlecolumn"),app.scope.$apply())};sizeChanged(),$(window).on("resize",sizeChanged),console.log("begin internal init"),loadScripts(0,function(){console.log("loaded scripts"),initEvents(function(){loadHostSettings(function(){initData(function(){console.log("loading context");var loadedctx=JSON.parse(localStorage["appcontext_"+settings.name]||"{}");settings.loadData.call(app,loadedctx,function(){attachEvents(function(){window.NativeNav&&(NativeNav.handleAction=function(route,action){var routeScope=app.scopesForRoutes[route];routeScope&&routeScope.$apply(action)}),settings.customInit.call(app,function(){loadFirstPage(function(){complete(function(){callback&&callback()})})})})})})})})})};settings.mightBePhoneGap&&"file:"==document.location.protocol?(app.isPhonegap=!0,app.platform="cordova",document.addEventListener("deviceready",function(){console.log("appframework deviceready"),window.device&&(console.log(device.platform),app.isSimulator=device.platform.indexOf("Simulator")>0),$(initInternal)},!1)):(app.platform="web",$(initInternal))};return app.module.run(["$rootScope","$compile","$controller",function($rootScope){app.rootScope=$rootScope,console.log("angular app module run"),init()}]),angular.element(document).ready(function(){angular.bootstrap(document,[app.module.name])}),app},angular.module("chondric").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("cjs-action-sheet.html",'<div cjs-popover="componentDefinition.popuptrigger">\n    <div class="poparrow"></div>\n    <button ng-repeat="b in componentDefinition.data.items" ng-tap="handleSharedPopupButtonClick(b)">{{b.title}}</button>\n</div>\n'),$templateCache.put("cjs-left-panel.html",'<div cjs-sidepanel="componentDefinition.popuptrigger">\n<div ng-include="componentDefinition.data.templateUrl"></div>\n</div>'),$templateCache.put("cjs-loading-overlay.html",'<div class="loadingoverlay" ng-show="dataLoadStatus.waitingForData">\n    <div ng-show="!dataLoadStatus.error" class="progress large">\n        <div></div>\n    </div>\n    <div ng-show="!dataLoadStatus.error">{{dataLoadStatus.message || "Loading"}}</div>\n    <div class="error" ng-show="dataLoadStatus.error">{{dataLoadStatus.error}}</div>\n    <div>\n        <button ng-show="dataLoadStatus.retry && dataLoadStatus.error" ng-tap="dataLoadStatus.retry()">Retry</button>\n        <button ng-show="dataLoadStatus.cancel" ng-tap="dataLoadStatus.cancel()">Cancel</button>\n    </div>\n</div>\n'),$templateCache.put("cjs-navigation-bar.html",'<div class="navbar" ng-style="{top: (-60 + (((globalHeaderOptions.v1.active && 60 || 0) * (1 - globalHeaderOptions.transitionState)) + ((globalHeaderOptions.v2.active && 60 || 0) * (globalHeaderOptions.transitionState))))+\'px\' }">\n    <div class="v1" ng-style="{opacity:(1-globalHeaderOptions.transitionState), \'z-index\': ((globalHeaderOptions.transitionState > 0.5) ? 1: 2)  }">\n        <button class="left" ng-repeat="b in globalHeaderOptions.v1.data.leftButtons" ng-tap="handleSharedHeaderButtonClick(globalHeaderOptions.v1, b, lastTap)">{{b.title}}</button>\n        <h1>{{globalHeaderOptions.v1.data.title}}</h1>\n        <button class="right" ng-repeat="b in globalHeaderOptions.v1.data.rightButtons" ng-tap="handleSharedHeaderButtonClick(globalHeaderOptions.v1, b, lastTap)">{{b.title}}</button>\n    </div>\n    <div class="v2" ng-style="{opacity:(globalHeaderOptions.transitionState), \'z-index\': ((globalHeaderOptions.transitionState > 0.5) ? 2: 1)}">\n        <button class="left" ng-repeat="b in globalHeaderOptions.v2.data.leftButtons" ng-tap="handleSharedHeaderButtonClick(globalHeaderOptions.v2, b, lastTap)">{{b.title}}</button>\n        <h1>{{globalHeaderOptions.v2.data.title}}</h1>\n        <button class="right" ng-repeat="b in globalHeaderOptions.v2.data.rightButtons" ng-tap="handleSharedHeaderButtonClick(globalHeaderOptions.v2, b, lastTap)">{{b.title}}</button>\n    </div>\n</div>\n'),$templateCache.put("cjs-preview-controls.html","<div id='previewcontrols'>\n    <button ng-tap='updatePreviewSettings(1024,768, true)'>iPad landscape</button>\n    <button ng-tap='updatePreviewSettings(768, 1024, true)'>iPad portrait</button>\n    <button ng-tap='updatePreviewSettings(568,320, true)'>iPhone5 landscape</button>\n    <button ng-tap='updatePreviewSettings(320, 568, true)'>iPhone5 portrait</button>\n    <button ng-tap='updatePreviewSettings(1024,748, false)'>iPad landscape iOS6</button>\n    <button ng-tap='updatePreviewSettings(768, 1004, false)'>iPad portrait iOS6</button>\n    <button ng-tap='updatePreviewSettings(568,300, false)'>iPhone5 landscape iOS6</button>\n    <button ng-tap='updatePreviewSettings(320,548, false)'>iPhone5 portrait iOS6</button>\n    <button ng-tap='reloadPreview()'>Reload</button>\n</div>\n"),$templateCache.put("cjs-right-panel.html",'<div cjs-sidepanel="componentDefinition.popuptrigger">\n<div ng-include="componentDefinition.data.templateUrl"></div>\n</div>'),$templateCache.put("cjs-shared-popup.html",'<div cjs-popup="componentDefinition.popuptrigger">\n<div ng-include="componentDefinition.data.templateUrl"></div>\n</div>')}]),Chondric.View=function(options){var settings={id:null,element:null,swipe:!0,swipeToBlank:!1};$.extend(settings,options),this.settings=settings;for(var k in settings)this[k]=settings[k];this.initInternal(settings)},$.extend(Chondric.View.prototype,{updateViewBackground:function(){this.updateView()},updateView:function(){},attachEvents:function(){console.log("no events to attach")},renderThumbnail:function(){},getDefaultModel:function(){return{}},updateModel:function(dataId,existingData,callback){this.model||(this.model=this.getDefaultModel());this.model;callback()},updateData:function(){},init:function(){},initAngular:function(){},initInternal:function(options){console.log("init view - "+options.testOption),this.init(options)},templateLoaded:function(){console.log("template loaded")},activating:function(){console.log("activating")},activated:function(){console.log("activated")},deactivating:function(){console.log("deactivating")},setSwipePosition:function(prevPageElement,nextPageElement,dx,duration){var thisPage=this;void 0!==duration&&(thisPage.element[0].style.webkitTransitionDuration=duration,nextPageElement&&nextPageElement[0]&&(nextPageElement[0].style.webkitTransitionDuration=duration),prevPageElement&&prevPageElement[0]&&(prevPageElement[0].style.webkitTransitionDuration=duration)),null===dx?(thisPage.element[0].style.webkitTransform=null,nextPageElement&&nextPageElement[0]&&(nextPageElement[0].style.webkitTransform=null),prevPageElement&&prevPageElement[0]&&(prevPageElement[0].style.webkitTransform=null)):void 0!==dx&&(prevPageElement&&prevPageElement.addClass("prev"),nextPageElement&&nextPageElement.addClass("next"),thisPage.element[0].style.webkitTransform="translateX("+dx+"px)",nextPageElement&&nextPageElement[0]&&0>dx&&(nextPageElement[0].style.webkitTransform="translateX("+(app.viewportWidth+10+dx)+"px)"),prevPageElement&&prevPageElement[0]&&dx>0&&(prevPageElement[0].style.webkitTransform="translateX("+(-app.viewportWidth-10+dx)+"px)"))},unload:function(){var view=this;view.element&&view.element.remove(),delete view.element,view.scope&&(view.scope.$destroy(),delete view.scope)},getViewTemplate:function(callback){var view=this,viewurl=view.templateFile+"?nocache="+app.startTime;$.get(viewurl,null,function(data){var html=$(data),pe=$(".page",html),content="";content=0===html.length?"Error - Invalid page template":html.hasClass("page")?html.html():pe.length>=1?pe.html():data;var ctrl=pe.attr("ng-controller")||html.attr("ng-controller");callback(content,ctrl)})},load:function(){var view=this;view.getViewTemplate(function(content,controllerName){var ind=view.id.indexOf("_"),templateId=view.templateId||view.id.substr(0,ind)||view.id;view.dataId=view.id.substr(ind+1)||"",view.params=view.dataId.split("_"),controllerName=controllerName||view.controllerName||templateId+"Ctrl";var controller=null;if(view.initAngular(),!controller&&view.controller)app.controllerProvider.register(controllerName,view.controller);else if(!controller&&view.controllers&&view.controllers[controllerName])for(var cn in view.controllers)app.controllerProvider.register(cn,view.controllers[cn]);else controllerName=null;var fullcontent="";fullcontent=controllerName?"<div ng-controller='"+controllerName+"'>"+content+"</div>":"<div ng-scope>"+content+"</div>";var newelement=app.compile(fullcontent)(app.rootScope);view.element.append(newelement),view.scope=newelement.scope(),view.isActivating&&(view.activating(),view.isActivating=!1),view.isActivated&&(view.activated(),view.isActivated=!1),view.scope.$apply(),view.updateViewBackground(),view.attachEvents(),view.loading=!1,view.element.removeClass("loading")})},ensureDataLoaded:function(callback){var view=this;if(view.model)callback();else{var ind=view.id.indexOf("_"),templateId=view.id.substr(0,ind)||view.id,dataId=view.id.substr(templateId.length+1);view.updateModel(dataId,null,callback)}},ensureLoaded:function(pageclass,callback){var view=this;if(view.element&&(!pageclass||view.element.attr("class")=="page "+templateId+" "+pageclass))return callback();var ind=view.id.indexOf("_"),templateId=view.id.substr(0,ind)||view.id,safeId=view.id.replace(/\/\.\|/g,"_");view.ensureDataLoaded(function(){view.element=$("#"+safeId),0==view.element.length&&(view.loading=!0,$(".viewport").append('<div class="page '+templateId+" notransition loading "+pageclass+'" id="'+safeId+'"></div>'),view.element=$("#"+safeId),view.element.append('<div class="content"></div>'),view.element.append('<div class="loadingOverlay"><a href="javascript:window.location.reload()">Reload</a></div>'),view.load()),pageclass&&($(".page."+pageclass).each(function(){this!=view.element[0]&&$(this).removeClass(pageclass)}),view.element.attr("class","page "+templateId+" notransition "+pageclass)),view.swipe&&view.element.addClass("swipe"),view.swipeToBlank&&view.element.addClass("swipetoblank"),view.loading&&view.element.addClass("loading"),window.setTimeout(function(){view.element.removeClass("notransition"),window.setTimeout(function(){callback()},0)},0)})},showNextPage:function(){this.next&&app.changePage(this.next,"next")},showPreviousPage:function(){this.prev&&app.changePage(this.prev,"prev")}}),Chondric.VersionedDatabase=function(db,updatefunctions,tables){this.sqlerror=function(t,err){err&&err.message?console.error(err.message):t&&t.message?console.error(t.message):err?console.error(err):t?console.error(t):console.log("sql error")};var sqlerror=this.sqlerror,getVersion=function(versionCallback){console.log("checking version"),db.transaction(function(tx){tx.executeSql("SELECT * FROM settings where key=?",["dbVersion"],function(t,result){if(0==result.rows.length)return versionCallback(0);var row=result.rows[0]||result.rows.item(0);window.setTimeout(function(){return versionCallback(parseFloat(row.val))},0)},function(){window.setTimeout(function(){versionCallback(0)},0)})},function(){window.setTimeout(function(){versionCallback(0)},0)})};this.updateDatabase=function(callback){getVersion(function(currentVersion){console.log("Current database version is "+currentVersion);var existingversion=currentVersion,versionQueue=[];for(vn in updatefunctions){var vv=parseFloat(vn);vv>existingversion&&versionQueue.push(vn)}return 0==versionQueue.length?callback():void db.transaction(function(tx){for(vn in updatefunctions){var vv=parseFloat(vn);vv>existingversion&&(updatefunctions[vn](tx),tx.executeSql("INSERT OR REPLACE INTO settings (key, val) VALUES (?, ?)",["dbVersion",vv],function(){},sqlerror),existingversion=vv)}},sqlerror,function(){callback()})})},this.dropDatabase=function(callback){db.transaction(function(tx){for(tn in tables)tx.executeSql("DROP TABLE "+tn,[],null,sqlerror)},sqlerror,function(){callback()})},this.resetDatabase=function(callback){var that=this;this.dropDatabase(function(){that.updateDatabase(callback)})}},Chondric.directive("ngTap",function(){return function(scope,element,attrs){function start(){useMouse?(element.bind("mousemove",move),element.bind("mouseout",cancel),element.bind("mouseup",action)):(element.bind("touchmove",move),element.bind("touchend",action)),element.addClass("active"),element.removeClass("deactivated"),active=!0}element.addClass("tappable"),attrs.ngTap&&0==attrs.ngTap.indexOf("app.")&&!scope.app&&(scope.app=app);var active=!1,touching=!1,move=function(e){cancel(e)},cancel=function(){useMouse?(element.unbind("mousemove",move),element.unbind("mouseout",cancel),element.unbind("mouseup",action)):(element.unbind("touchmove",move),element.unbind("touchend",action)),element.removeClass("active"),element.addClass("deactivated"),touching=!1,active=!1},action=function(e){scope.lastTap={element:element,x:e.originalEvent.changedTouches?e.originalEvent.changedTouches.offsetX:e.offsetX,y:e.originalEvent.changedTouches?e.originalEvent.changedTouches.offsetY:e.offsetY},scope.$apply(attrs.ngTap,element),useMouse?(element.unbind("mousemove",move),element.unbind("mouseout",cancel),element.unbind("mouseup",action)):(element.unbind("touchmove",move),element.unbind("touchend",action)),touching=!1,active=!1,element.removeClass("active"),element.addClass("deactivated")},mouseStart=function(){active||touching||(touching=!1,start())},touchStart=function(){active||(touching=!0,start())},useMouse=!0,iOS=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;iOS?(useMouse=!1,element.bind("touchstart",touchStart)):element.bind("mousedown",mouseStart)}}),Chondric.directive("cjsLoadingOverlay",function(){return{replace:!0,templateUrl:"cjs-loading-overlay.html"}}),Chondric.directive("cjsShowAfterLoad",function($compile){return{restrict:"A",scope:{cjsShowAfterLoad:"="},link:function(scope,element){var contentElement=(element.contents(),angular.element(element[0].outerHTML));contentElement.removeAttr("cjs-show-after-load"),contentElement.attr("ui-toggle","!currentTask");var overlay=angular.element("<div>Loading ({{message}})</div>");overlay.attr("ui-toggle","currentTask");var wrapper=angular.element("<div></div>");wrapper.append(overlay),wrapper.append(contentElement),$compile(wrapper)(scope),element.replaceWith(wrapper),scope.$watch("cjsShowAfterLoad",function(status){if(status){for(var currentTask=null,i=0;i<status.tasks.length;i++){var task=status.tasks[i];if(task.error){currentTask=task;break}task.progressCurrent<task.progressTotal&&(!currentTask||task.progressTotal>currentTask.progressTotal)&&(currentTask=task)}scope.currentTask=currentTask,scope.message=currentTask?currentTask.error?"error":currentTask.progressCurrent+" / "+currentTask.progressTotal:"finished"}},!0)}}}),Chondric.directive("cjsPopover",function(){return{link:function(scope,element,attrs){function ensureOverlay(element,useOverlay){var parentPageElement=element.closest(".chondric-page");if(0==parentPageElement.length&&(parentPageElement=element.closest(".chondric-section")),0==parentPageElement.length&&(parentPageElement=element.closest(".chondric-viewport")),useOverlay){var overlay=$(".modal-overlay",parentPageElement);0==overlay.length&&(overlay=angular.element('<div class="modal-overlay"></div>'),parentPageElement.append(overlay));var hide=function(){console.log("overlay touch"),scope.$apply("hideModal('"+attrs.cjsPopover+"')"),overlay.off(useMouse?"mousedown":"touchstart",hide)};return overlay.on(useMouse?"mousedown":"touchstart",hide),overlay}}var useOverlay=void 0===attrs.noOverlay,horizontal=void 0!==attrs.horizontal,menuwidth=parseFloat(attrs.menuwidth)||280,menuheight=parseFloat(attrs.menuheight)||150,useMouse=!0,iOS=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;iOS&&(useMouse=!1),element.addClass("modal"),element.addClass("popover"),scope.$watch(attrs.cjsPopover,function(val){document.activeElement&&document.activeElement.blur();var overlay=ensureOverlay(element,useOverlay);if(val){menuheight=element.height()||menuheight,menuwidth=element.width()||menuwidth;var menupos={},sw=element[0].offsetParent.offsetWidth,sh=element[0].offsetParent.offsetHeight,horizontalCutoff=sw/2,verticalCutoff=sh/2,idealX=0,idealY=0;if(val.element&&val.element[0]){var button=val.element[0],cr=button.getBoundingClientRect();horizontal?(idealX=cr.right>horizontalCutoff?cr.right:cr.left,idealY=cr.top+cr.height/2):(idealX=cr.left+cr.width/2,idealY=cr.bottom>verticalCutoff?cr.top:cr.bottom)}else idealX=val.x||0,idealY=val.y||0;var actualX=idealX,actualY=idealY;horizontal?(0>idealY-10-menuheight/2&&(actualY=menuheight/2+10),idealY+10+menuheight/2>sh&&(actualY=sh-menuheight/2-10)):(0>idealX-10-menuwidth/2&&(actualX=menuwidth/2+10),idealX+10+menuwidth/2>sw&&(actualX=sw-menuwidth/2-10)),horizontal?(horizontalCutoff>actualX?(menupos.left=actualX+13+"px",menupos.right="auto",element.addClass("right").removeClass("left")):(menupos.right=sw-actualX+13+"px",menupos.left="auto",element.addClass("left").removeClass("right")),menupos.top=actualY-menuheight/2+"px"):(verticalCutoff>actualY?(menupos.top=actualY+13+"px",menupos.bottom="auto",element.addClass("down").removeClass("up")):(menupos.bottom=sh-actualY+13+"px",menupos.top="auto",element.addClass("up").removeClass("down")),menupos.left=actualX-menuwidth/2+"px");var indel=$(".poparrow",element);if(indel.length>0)if(horizontal){var arrowtop=idealY-(actualY-menuheight/2)-13;10>arrowtop&&(arrowtop=10),arrowtop+26>menuheight-10&&(arrowtop=menuheight-10-26),indel.css("top",arrowtop+"px")
}else{var arrowleft=idealX-(actualX-menuwidth/2)-13;10>arrowleft&&(arrowleft=10),arrowleft+26>menuwidth-10&&(arrowleft=menuwidth-10-26),indel.css("left",arrowleft+"px")}useOverlay&&overlay.addClass("active"),element.addClass("active"),element.css(menupos)}else useOverlay&&overlay.removeClass("active"),element.removeClass("active")})}}}),Chondric.directive("cjsPopup",function(){return{link:function(scope,element,attrs){var useMouse=!0,iOS=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;iOS&&(useMouse=!1),element.addClass("modal"),element.addClass("popup");var parentPageElement=element.closest(".chondric-page");0==parentPageElement.length&&(parentPageElement=element.closest(".chondric-section")),0==parentPageElement.length&&(parentPageElement=element.closest(".chondric-viewport"));var overlay=$(".modal-overlay",parentPageElement);0==overlay.length&&(overlay=angular.element('<div class="modal-overlay"></div>'),parentPageElement.append(overlay)),overlay.on(useMouse?"mousedown":"touchstart",function(){console.log("overlay touch"),scope.$apply("hideModal('"+attrs.cjsPopup+"')")}),scope.$watch(attrs.cjsPopup,function(val){document.activeElement&&document.activeElement.blur(),val?(overlay.addClass("active"),element.addClass("active")):(overlay.removeClass("active"),element.removeClass("active"))})}}}),Chondric.directive("cjsSidepanel",function(){var panelTransitions={revealRight:{init:function(){},progress:function(){},cancel:function(){},complete:function(){},reset:function(){}},coverRight:{init:function(panel,page,overlay){var spwidth=panel.width();overlay.css({visibility:"visible","-webkit-transition":"none",opacity:"0"}),panel.css({right:0,left:"auto",display:"block","-webkit-transition":"none","-webkit-transform":"translate("+spwidth+"px, 0)"})},progress:function(panel,page,overlay,progress){var spwidth=panel.width();overlay.css({visibility:"visible","-webkit-transition":"none",opacity:.3*progress}),panel.css({right:0,left:"auto",display:"block","-webkit-transition":"none","-webkit-transform":"translate("+(spwidth-progress*spwidth)+"px, 0)"})},cancel:function(panel,page,overlay,prevProgress){var time=300*prevProgress,spwidth=panel.width();return overlay.css({visibility:"visible","-webkit-transition":"opacity "+time+"ms ease-in-out",opacity:"0"}),panel.css({display:"block","-webkit-transition":"-webkit-transform "+time+"ms ease-in-out","-webkit-transform":"translate("+spwidth+"px, 0)"}),time},complete:function(panel,page,overlay,prevProgress){var time=300*(1-prevProgress);return overlay.css({visibility:"visible","-webkit-transition":"opacity "+time+"ms ease-in-out",opacity:"0.3"}),panel.css({display:"block","-webkit-transition":"-webkit-transform "+time+"ms ease-in-out","-webkit-transform":"translate(0px, 0)"}),time},reset:function(panel,page,overlay){overlay.css({visibility:"","-webkit-transition":"",opacity:""}),panel.css({display:"","-webkit-transition":"","-webkit-transform":""})}},slideRight:{init:function(){},progress:function(){},cancel:function(){},complete:function(){},reset:function(){}},revealLeft:{init:function(){},progress:function(){},cancel:function(){},complete:function(){},reset:function(){}},coverLeft:{init:function(panel,page,overlay){var spwidth=panel.width();overlay.css({visibility:"visible","-webkit-transition":"none",opacity:"0"}),panel.css({left:0,right:"auto",display:"block","-webkit-transition":"none","-webkit-transform":"translate("+-spwidth+"px, 0)"})},progress:function(panel,page,overlay,progress){var spwidth=panel.width();overlay.css({visibility:"visible","-webkit-transition":"none",opacity:.3*progress}),panel.css({left:0,right:"auto",display:"block","-webkit-transition":"none","-webkit-transform":"translate("+(-spwidth+progress*spwidth)+"px, 0)"})},cancel:function(panel,page,overlay,prevProgress){var time=300*prevProgress,spwidth=panel.width();return overlay.css({visibility:"visible","-webkit-transition":"opacity "+time+"ms ease-in-out",opacity:"0"}),panel.css({display:"block","-webkit-transition":"-webkit-transform "+time+"ms ease-in-out","-webkit-transform":"translate("+-spwidth+"px, 0)"}),time},complete:function(panel,page,overlay,prevProgress){var time=300*(1-prevProgress);return overlay.css({visibility:"visible","-webkit-transition":"opacity "+time+"ms ease-in-out",opacity:"0.3"}),panel.css({display:"block","-webkit-transition":"-webkit-transform "+time+"ms ease-in-out","-webkit-transform":"translate(0px, 0)"}),time},reset:function(panel,page,overlay){overlay.css({visibility:"","-webkit-transition":"",opacity:""}),panel.css({display:"","-webkit-transition":"","-webkit-transform":""})}},slideLeft:{init:function(){},progress:function(){},cancel:function(){},complete:function(){},reset:function(){}}};return{link:function(scope,element,attrs){var useMouse=!0,iOS=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;iOS&&(useMouse=!1),element.addClass("modal"),element.addClass("sidepanel");var pushmode;element.hasClass("left")?element.hasClass("push")&&(pushmode="right"):(element.addClass("right"),element.hasClass("push")&&(pushmode="left"));var parentPageElement=element.closest(".chondric-page");0==parentPageElement.length&&(parentPageElement=element.closest(".chondric-section")),0==parentPageElement.length&&(parentPageElement=element.closest(".chondric-viewport"));var overlay=$(".modal-overlay",parentPageElement);0==overlay.length&&(overlay=angular.element('<div class="modal-overlay"></div>'),parentPageElement.append(overlay));var overlay=$(".modal-overlay",parentPageElement);0==overlay.length&&(overlay=angular.element('<div class="modal-overlay"></div>'),parentPageElement.append(overlay)),pushmode&&parentPageElement.addClass("haspushpanel"),overlay.on(useMouse?"mousedown":"touchstart",function(){scope.$apply("hideModal('"+attrs.cjsSidepanel+"')")}),scope.$watch(attrs.cjsSidepanel,function(val,oldval){if(val||oldval){document.activeElement&&document.activeElement.blur();var transition="coverRight",progress=0,oldprogress=0,spwidth=element.width()||200,dwidth=$(document).width();if(val&&val.transition?transition=val.transition:oldval&&oldval.transition&&(transition=oldval.transition),progress=val&&val.progress?Math.min(1,val.progress*dwidth/spwidth):0,console.log(progress),oldprogress=oldval&&oldval.progress?Math.min(1,oldval.progress*dwidth/spwidth):0,1==progress)overlay.addClass("active"),oldprogress||panelTransitions[transition].init(element,parentPageElement,overlay),window.setTimeout(function(){panelTransitions[transition].complete(element,parentPageElement,overlay,oldprogress)},0);else if(0==progress){var time=panelTransitions[transition].cancel(element,parentPageElement,overlay,oldprogress);window.setTimeout(function(){panelTransitions[transition].reset(element,parentPageElement,overlay)},time),overlay.removeClass("active")}else panelTransitions[transition].progress(element,parentPageElement,overlay,progress),overlay.addClass("active")}})}}}),Chondric.directive("cjsSwipe",function(){return{link:function(scope,element){function move(e){e.originalEvent.changedTouches?(dx=e.originalEvent.changedTouches[0].clientX-startX,dy=e.originalEvent.changedTouches[0].clientY-startY):(dx=e.clientX-startX,dy=e.clientY-startY),swipeState.left?swipeState.left=Math.max(0,-dx/width):swipeState.right?swipeState.right=Math.max(0,dx/width):swipeState.leftBorder?swipeState.leftBorder=Math.max(0,dx/width):swipeState.rightBorder?swipeState.rightBorder=Math.max(0,-dx/width):swipeState.up?swipeState.up=Math.max(0,-dy/height):swipeState.down?swipeState.down=Math.max(0,dy/height):swipeState.topBorder?swipeState.topBorder=Math.max(0,dy/height):swipeState.bottomBorder?swipeState.bottomBorder=Math.max(0,-dy/height):dx>threshold&&Math.abs(dy)<threshold?10>startX?swipeState.leftBorder=dx/width:swipeState.right=dx/width:-dx>threshold&&Math.abs(dy)<threshold?startX>width-10?swipeState.rightBorder=-dx/width:swipeState.left=-dx/width:dy>threshold&&Math.abs(dx)<threshold?10>startY?swipeState.topBorder=dy/height:swipeState.down=dy/height:-dy>threshold&&Math.abs(dx)<threshold&&(startY>height-10?swipeState.bottomBorder=-dy/height:swipeState.up=-dy/height),updateSwipe&&updateSwipe(swipeState,swipeNav,scope)}function end(){tracking&&(tracking=!1,$(document).off(useMouse?"mousemove":"touchmove",move),$(document).off(useMouse?"mouseup":"touchend",end),endSwipe&&endSwipe(swipeState,swipeNav,scope),swipeState={left:0,right:0,up:0,down:0,leftBorder:0,rightBorder:0,topBorder:0,bottomBorder:0})}var useMouse=!0,iOS=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;iOS&&(useMouse=!1);var swipeNav,startX=0,startY=0,threshold=20,dx=0,dy=0,width=0,height=0,swipeState={left:0,right:0,up:0,down:0,leftborder:0,rightborder:0,topborder:0,bottomborder:0},tracking=!1,updateSwipe=scope.$eval("updateSwipe"),endSwipe=scope.$eval("endSwipe");element.on(useMouse?"mousedown":"touchstart",function(e){tracking||(tracking=!0,e.originalEvent.changedTouches?(startX=e.originalEvent.changedTouches[0].clientX,startY=e.originalEvent.changedTouches[0].clientY):(startX=e.clientX,startY=e.clientY),dx=0,dy=0,width=element.width(),height=element.height(),console.log(width),console.log(height),swipeState={left:0,right:0,up:0,down:0,leftBorder:0,rightBorder:0,topBorder:0,bottomBorder:0},$(document).on(useMouse?"mousemove":"touchmove",move),$(document).on(useMouse?"mouseup":"touchend",end),swipeNav=scope.$eval("swipeNav"))})}}}),Chondric.directive("cjsTransitionStyle",function(){return{link:function($scope,element,attrs){$scope.$watch("transition",function(transition,old){if(transition){var td=app.allTransitions[transition.type];if(td){var isNewTransition=!old||transition.from!=old.from||transition.to!=old.to||0==old.progress||1==old.progress;if(attrs.route==transition.to)if(0==transition.progress&&isNewTransition)td.transitionIn.start(element);else if(0!=transition.progress||isNewTransition)if(1==transition.progress){var time=td.transitionIn.complete(element,old.progress);window.setTimeout(function(){td.reset(element)},time)}else td.transitionIn.progress(element,transition.progress);else{var time=td.transitionIn.cancel(element,old.progress);window.setTimeout(function(){td.reset(element)},time)}else if(attrs.route==transition.from)if(0==transition.progress&&isNewTransition)td.transitionOut.start(element);else if(0!=transition.progress||isNewTransition)if(1==transition.progress){var time=td.transitionOut.complete(element,old.progress);window.setTimeout(function(){td.reset(element)},time)}else td.transitionOut.progress(element,transition.progress);else{var time=td.transitionOut.cancel(element,old.progress);window.setTimeout(function(){td.reset(element)},time)}}}},!0)}}}),Chondric.directive("cjsPreviewControls",function(){return{restrict:"AE",replace:!0,templateUrl:"cjs-preview-controls.html",link:function(scope){scope.previewSettings={width:1024,height:768,overlayStatusBar:!0},scope.reloadPreview=function(){document.getElementById("preview").contentDocument.location.reload(!0)},scope.updatePreviewSettings=function(w,h,overlayStatusBar){scope.previewSettings={width:w,height:h,overlayStatusBar:overlayStatusBar}}}}}),Chondric.directive("chondricViewport",function($compile){return{scope:!0,link:function(scope,element,attrs){var rk=scope.$eval("rk"),rv=scope.$eval("rv");if(rv&&(scope.pageParams=rv.params||{}),rk&&(scope.pageRoute=rk),rk||"1"!=attrs["chondric-viewport"]){var template="";rv?rv.isSection?(template='<div ng-controller="rv.controller" >',template+='<div ng-repeat="(rk, rv) in rv.subsections" chondric-viewport="1" class="{{rv.templateId}}" ng-class="{\'chondric-section\': rv.isSection, \'chondric-page\': !rv.isSection, active: rk == route, next: rk == nextRoute, prev: rk == lastRoute}" cjs-transition-style route="{{rk}}">',template+="</div>",template+="</div>"):rv.templateUrl?(template='<div  ng-controller="rv.controller" cjs-swipe> <div ng-include src="rv.templateUrl"></div>',template+="<div cjs-loading-overlay></div></div>"):template="<span>Template not set</span>":(scope.handleSharedPopupButtonClick=function(b){var options=scope.globalPopupMenu;scope.hideModal("globalPopupMenu"),b.action&&options.scope.$eval(b.action)},element.addClass("chondric-viewport"),template='<div ng-repeat="(rk, rv) in openViews" chondric-viewport="1" class="{{rv.templateId}}" ng-class="{\'chondric-section\': rv.isSection, \'chondric-page\': !rv.isSection, active: rk == route, next: rk == nextRoute, prev: rk == lastRoute}" cjs-transition-style route="{{rk}}">',template+="</div>",template+='<div ng-repeat="(ck, componentDefinition) in sharedUiComponents" cjs-shared-component>',template+="</div>");var newElement=angular.element(template);$compile(newElement)(scope),element.html(""),element.append(newElement)}}}}),Chondric.directive("cjsSharedComponent",function($compile){return{scope:!0,link:function(scope,element){var cd=scope.componentDefinition;element.addClass("sharedcomponent-"+cd.id);var template="";template+='<div ng-controller="componentDefinition.controller" >',cd.template?template+=cd.template:cd.templateUrl&&(template+='<div ng-include src="componentDefinition.templateUrl"></div>'),template+="</div>";var newElement=angular.element(template);$compile(newElement)(scope),element.html(""),element.append(newElement)}}}),Chondric.registerSharedUiComponent({id:"cjs-action-sheet",templateUrl:"cjs-action-sheet.html",controller:function($scope){var self=$scope.componentDefinition;$scope.hideModal=function(){self.popuptrigger=null;var routeScope=app.scopesForRoutes[self.route];app.setSharedUiComponentState(routeScope,"cjs-action-sheet",!1,!0,null)},$scope.handleSharedPopupButtonClick=function(b){self.popuptrigger=null;var routeScope=app.scopesForRoutes[self.route];routeScope&&b.action&&routeScope.$eval(b.action)}},setState:function(self,route,active,available,data){if(self.data=data,self.route=route,window.NativeNav){var rect=popupoptions.element[0].getBoundingClientRect();NativeNav.showPopupMenu(popupoptions.scope.rk,rect.left,rect.top,rect.width,rect.height,popupoptions.items)}else self.popuptrigger=active?{element:data.element}:null}}),Chondric.registerSharedUiComponent({id:"cjs-navigation-bar",templateUrl:"cjs-navigation-bar.html",controller:function($scope){var self=$scope.componentDefinition;$scope.globalHeaderOptions=self.globalHeaderOptions={},$scope.handleSharedHeaderButtonClick=function(headerOptions,b,lastTap){console.log("clicked header button for "+self.route);var routeScope=app.scopesForRoutes[self.route];routeScope&&b.action?routeScope.$eval(b.action):routeScope&&b.items&&app.setSharedUiComponentState(routeScope,"cjs-action-sheet",!0,!0,{element:lastTap.element,items:b.items})}},setStatePartial:function(self,initialState,finalState,progress){if(self.globalHeaderOptions){{var v1=self.globalHeaderOptions.v1;self.globalHeaderOptions.v2}v1&&v1.route==initialState.route?(self.globalHeaderOptions.v1=initialState,self.globalHeaderOptions.v2=finalState,self.globalHeaderOptions.transitionState=progress):(self.globalHeaderOptions.v2=initialState,self.globalHeaderOptions.v1=finalState,self.globalHeaderOptions.transitionState=1-progress),.5>progress?(self.route=initialState.route,self.data=initialState.data):(self.route=finalState.route,self.data=finalState.data)}},setState:function(self,route,active,available,data){if(self.globalHeaderOptions){self.route=route,self.data=data;{var v1=self.globalHeaderOptions.v1;self.globalHeaderOptions.v2}v1&&v1.route==route?(self.globalHeaderOptions.v1={route:route,active:active,available:available,data:data},self.globalHeaderOptions.transitionState=0):(self.globalHeaderOptions.v2={route:route,active:active,available:available,data:data},self.globalHeaderOptions.transitionState=1)}}}),Chondric.registerSharedUiComponent({id:"cjs-shared-popup",templateUrl:"cjs-shared-popup.html",controller:function($scope){var self=$scope.componentDefinition;self.scope=$scope,self.defaultController=function(){},$scope.hideModal=function(){self.popuptrigger=null;var routeScope=app.scopesForRoutes[self.route];app.setSharedUiComponentState(routeScope,"cjs-shared-popup",!1,!0,null)},$scope.handleAction=function(funcName,params){self.popuptrigger=null;var routeScope=app.scopesForRoutes[self.route];routeScope&&routeScope.$eval(funcName)(params)}},setState:function(self,route,active,available,data){self.data=data,self.route=route,self.popuptrigger=active?{}:null}}),Chondric.registerSharedUiComponent({id:"cjs-right-panel",templateUrl:"cjs-right-panel.html",controller:function($scope){var self=$scope.componentDefinition;self.scope=$scope,self.defaultController=function(){},$scope.hideModal=function(){var routeScope=app.scopesForRoutes[self.route];app.setSharedUiComponentState(routeScope,"cjs-right-panel",!1,!0,self.data)},$scope.handleAction=function(funcName,params){self.popuptrigger=null;var routeScope=app.scopesForRoutes[self.route];routeScope&&routeScope.$eval(funcName)(params)}},setState:function(self,route,active,available,data){self.data=data,self.route=route,self.active=active,self.available=available,self.popuptrigger=active?{progress:1,transition:"coverRight"}:{progress:0,transition:"coverRight"}},updateSwipe:function(self,swipeState){self.available&&(self.active||swipeState.rightBorder&&(self.popuptrigger={progress:swipeState.rightBorder,transition:"coverRight"},self.scope.$apply()))},endSwipe:function(self,swipeState){self.available&&(self.active||swipeState.rightBorder&&(swipeState.rightBorder<.1?(self.popuptrigger={progress:0,transition:"coverRight"},self.scope.$apply()):(self.popuptrigger={progress:1,transition:"coverRight"},self.scope.$apply())))}}),Chondric.registerSharedUiComponent({id:"cjs-left-panel",templateUrl:"cjs-left-panel.html",controller:function($scope){var self=$scope.componentDefinition;self.scope=$scope,self.defaultController=function(){},$scope.hideModal=function(){var routeScope=app.scopesForRoutes[self.route];app.setSharedUiComponentState(routeScope,"cjs-left-panel",!1,!0,self.data)},$scope.handleAction=function(funcName,params){self.popuptrigger=null;var routeScope=app.scopesForRoutes[self.route];routeScope&&routeScope.$eval(funcName)(params)}},setState:function(self,route,active,available,data){self.data=data,self.route=route,self.active=active,self.available=available,self.popuptrigger=active?{progress:1,transition:"coverLeft"}:{progress:0,transition:"coverLeft"}},updateSwipe:function(self,swipeState){self.available&&(self.active||swipeState.leftBorder&&(self.popuptrigger={progress:swipeState.leftBorder,transition:"coverLeft"},self.scope.$apply()))},endSwipe:function(self,swipeState){self.available&&(self.active||swipeState.leftBorder&&(swipeState.leftBorder<.1?(self.popuptrigger={progress:0,transition:"coverLeft"},self.scope.$apply()):(self.popuptrigger={progress:1,transition:"coverLeft"},self.scope.$apply())))}}),Chondric.allTransitions.crossfade={transitionIn:{start:function(element){element.css({display:"block",opacity:0,"z-index":9e3})},cancel:function(element,prevProgress){var time=300*prevProgress;return $(element).css({"-webkit-transition":"opacity "+time+"ms ease-in-out",opacity:0}),time},complete:function(element,prevProgress){var time=300*(1-prevProgress);return $(element).css({"-webkit-transition":"opacity "+time+"ms ease-in-out",opacity:1}),time},progress:function(element,progress){element.css({display:"block",opacity:progress,"z-index":9e3})}},transitionOut:{start:function(element){element.css({display:"block"})},cancel:function(element,prevProgress){var time=300*prevProgress;return time},complete:function(element,prevProgress){var time=300*(1-prevProgress);return time},progress:function(element){element.css({display:"block"})}},reset:function(element){element.css({display:"",opacity:"","z-index":"","-webkit-transition":""})}},Chondric.allTransitions.slideleft={transitionIn:{start:function(element){$(element).css({display:"block"}),$(".body",element).css({"-webkit-transition":"none","-webkit-transform":"translate(100%, 0)"})},cancel:function(element,prevProgress){var time=300*prevProgress;return $(".body",element).css({"-webkit-transition":"-webkit-transform "+time+"ms ease-in-out","-webkit-transform":"translate(100%, 0)"}),time},complete:function(element,prevProgress){var time=300*(1-prevProgress);return $(".body",element).css({"-webkit-transition":"-webkit-transform "+time+"ms ease-in-out","-webkit-transform":"translate(0, 0)"}),time},progress:function(element,progress){$(element).css({display:"block"}),$(".body",element).css({"-webkit-transition":"none","-webkit-transform":"translate("+100*(1-progress)+"%, 0)"})}},transitionOut:{start:function(element){$(".body",element).css({"-webkit-transition":"none","-webkit-transform":"translate(0, 0)"})},cancel:function(element,prevProgress){var time=300*prevProgress;return $(".body",element).css({"-webkit-transition":"-webkit-transform "+time+"ms ease-in-out","-webkit-transform":"translate(0, 0)"}),time},complete:function(element,prevProgress){var time=300*(1-prevProgress);return $(".body",element).css({"-webkit-transition":"-webkit-transform "+time+"ms ease-in-out","-webkit-transform":"translate(-100%, 0)"}),time},progress:function(element,progress){$(element).css({display:"block"}),$(".body",element).css({"-webkit-transition":"none","-webkit-transform":"translate("+-100*progress+"%, 0)"})}},reset:function(element){element.css({display:""}),$(".body",element).css({"-webkit-transition":"","-webkit-transform":""})}},Chondric.allTransitions.slideright={transitionIn:{start:function(element){$(element).css({display:"block"}),$(".body",element).css({"-webkit-transition":"none","-webkit-transform":"translate(-100%, 0)"})},cancel:function(element,prevProgress){var time=300*prevProgress;return $(".body",element).css({"-webkit-transition":"-webkit-transform "+time+"ms ease-in-out","-webkit-transform":"translate(-100%, 0)"}),time},complete:function(element,prevProgress){var time=300*(1-prevProgress);return $(".body",element).css({"-webkit-transition":"-webkit-transform "+time+"ms ease-in-out","-webkit-transform":"translate(0, 0)"}),time},progress:function(element,progress){$(element).css({display:"block"}),$(".body",element).css({"-webkit-transition":"none","-webkit-transform":"translate("+-100*(1-progress)+"%, 0)"})}},transitionOut:{start:function(element){$(".body",element).css({"-webkit-transition":"none","-webkit-transform":"translate(0, 0)"})},cancel:function(element,prevProgress){var time=300*prevProgress;return $(".body",element).css({"-webkit-transition":"-webkit-transform "+time+"ms ease-in-out","-webkit-transform":"translate(0, 0)"}),time},complete:function(element,prevProgress){var time=300*(1-prevProgress);return $(".body",element).css({"-webkit-transition":"-webkit-transform "+time+"ms ease-in-out","-webkit-transform":"translate(100%, 0)"}),time},progress:function(element,progress){$(element).css({display:"block"}),$(".body",element).css({"-webkit-transition":"none","-webkit-transform":"translate("+100*progress+"%, 0)"})}},reset:function(element){element.css({display:""}),$(".body",element).css({"-webkit-transition":"","-webkit-transform":""})}},Chondric.Syncable=function(options){var syncable=this,localIndex={},remoteIndex={},settings=syncable.settings={bulkSave:!1,saveAllToDb:function(){},saveToDb:function(){},removeFromDb:function(){},getRemoteId:function(remoteVersion){return remoteVersion.key},merge:function(wrapper,callback){wrapper.localId||(wrapper.localId=wrapper.remoteId),wrapper.hasLocalChanges||(wrapper.localVersion=wrapper.unmergedRemoteVersion),wrapper.unmergedRemoteVersion&&(wrapper.remoteVersion=wrapper.unmergedRemoteVersion,delete wrapper.unmergedRemoteVersion),wrapper.remoteVersion&&(wrapper.remoteId=settings.getRemoteId(wrapper.remoteVersion)),callback()},upload:function(wrapper,callback){callback()}};return $.extend(settings,options),syncable.updateIndex=function(wrapper){wrapper.remoteId&&(remoteIndex[wrapper.remoteId]=wrapper),wrapper.localId&&(localIndex[wrapper.localId]=wrapper)},syncable.getByRemoteId=function(id,callback){if(remoteIndex[id])return callback(remoteIndex[id]);var wrapper={remoteId:id};return callback(wrapper)},syncable.getByLocalId=function(id,callback){return callback(localIndex[id])},syncable.addNew=function(localId,localVersion){var wrapper={localId:localId,localVersion:localVersion,hasLocalChanges:!0,lastModified:(new Date).getTime()};return syncable.updateIndex(wrapper),wrapper},syncable.save=function(wrapper){syncable.updateIndex(wrapper),settings.bulkSave?settings.saveAllToDb(localIndex):settings.saveToDb(wrapper)},syncable.queueSave=function(wrapper,lastModified,isSystemUpdate){isSystemUpdate||(wrapper.hasLocalChanges=!0),wrapper.lastModified=lastModified||(new Date).getTime(),syncable.save(wrapper)},syncable.loadFromDbResults=function(wrappers){for(var i=0;i<wrappers.length;i++){var wrapper=wrappers[i];wrapper.remoteId&&remoteIndex[wrapper.remoteId]||wrapper.localId&&localIndex[wrapper.localId]||syncable.updateIndex(wrapper)}},syncable.loadSavedLocalIndex=function(data){localIndex=data;for(var li in data)syncable.updateIndex(data[li])},syncable.sync=function(wrapper,getRemoteVersion,mergeFunction,uploadFunction,callback){getRemoteVersion(wrapper.remoteId,function(newRemoteVersion){wrapper.unmergedRemoteVersion=newRemoteVersion,(mergeFunction||settings.merge)(wrapper,function(){syncable.updateIndex(wrapper),wrapper.hasLocalChanges?uploadFunction(wrapper,function(){(mergeFunction||settings.merge)(wrapper,function(){syncable.updateIndex(wrapper),syncable.queueSave(wrapper,wrapper.lastModified,!0),callback()})}):(syncable.queueSave(wrapper,wrapper.lastModified,!0),callback())})})},syncable.syncRemoteIndex=function(remoteObjects,callback){var keys=[];for(var rk in remoteObjects)keys.push(rk);var processItem=function(i){return i>=keys.length?callback():void syncable.getByRemoteId(keys[i],function(wrapper){syncable.sync(wrapper,function(remoteId,callback){callback(remoteObjects[keys[i]])},settings.merge,settings.upload,function(){processItem(i+1)})})};processItem(0)},syncable.syncRemoteArray=function(){},syncable.syncLocalChanges=function(callback){syncable.getItems(function(item){return item.hasLocalChanges},function(changedItems){var loopfn=function(i){return i>=changedItems.length?callback():changedItems[i].unmergedRemoteVersion?loopfn(i+1):void syncable.sync(changedItems[i],function(remoteId,callback){callback(changedItems[i].remoteVersion)},settings.merge,settings.upload,function(){loopfn(i+1)})};loopfn(0)})},syncable.uncache=function(filter,callback){var result=[];for(var li in localIndex){var item=localIndex[li];(!filter||filter(localIndex[li]))&&(delete localIndex[li],delete remoteIndex[item.remoteId],settings.bulkSave||settings.removeFromDb(item))}settings.bulkSave&&settings.saveAllToDb(localIndex),callback(result)},syncable.getItems=function(filter,callback){var result=[];for(var li in localIndex)(!filter||filter(localIndex[li]))&&result.push(localIndex[li]);callback(result)},this};
//# sourceMappingURL=chondric.min.map